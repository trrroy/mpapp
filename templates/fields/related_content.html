  <div ng-repeat-start="fc in related" class="section {{'section-'+$index}}" ng-class="{guide: item.type == 'guide', term: item.tid && $state.current.name != 'tabs.home'}"  ng-init="parentIndex = $index">
    <div ng-if="!(parentIndex > 1 && width && width < 420 && $state.current.name == 'tabs.home')" class="content-wrapper">
      <div ng-class="{'gallery-big': ((width && width >= 1280 && parentIndex == 0 && (item.tid || item.type == 'guide' || item.type== 'areaguide')) || (width && width >= 1280 && parentIndex > 0) || ((width && width < 1280) && ((width && width >= 420 && parentIndex > 1 && item.type != 'guide') || (parentIndex > 0 && item.type == 'guide')))), mobile: width && width < 1280, 'gallery' : ((width && width < 1280 || (item.nid && item.type != 'guide' && item.type !='areaguide')) && (parentIndex == 0 || (parentIndex == 1 && item.type != 'guide'))), home: $state.current.name == 'tabs.home'}"
        ng-attr-gallery="{{((width && width < 1280 || (item.nid && item.type != 'guide' && item.type !='areaguide')) && (parentIndex == 0 || (parentIndex == 1 && item.type != 'guide'))) === true ? true : undefined}}">
        <!-- shown for desktop if 1st section and term/guide/areaguide -->
        <!-- OR, desktop and anything after first section -->
        <!-- OR, mobile and any section after the two sections -->
        <div ng-if="$index == 0 && $state.current.name == 'tabs.home' && width && width >= 1280" id="spotlight"></div>
        <h3 ng-if="($state.current.name == 'tabs.home' && width && width >= 1280) || ($index > 0 && width > 420) || (width <= 420 && $index >= 1 && $state.current.name != 'tabs.home')" ng-bind-html="fc.headline.value | sanitize"></h3>
        <h3 ng-if="$state.current.name != 'tabs.home' && $index == 0 && item.nid && (width && width >= 1280 && (item.type == 'guide' || item.type == 'areaguide'))" ng-bind-html="item.title | sanitize"></h3>
        <h3 ng-if="$state.current.name != 'tabs.home' && $index == 0 && item.tid" ng-bind-html="item.name | sanitize"></h3>
        <div ng-if="$state.current.name != 'tabs.home' && $index == 0 && item.tid" ng-bind-html="item.description | sanitize" class="description"></div>
        <div class="listings-wrapper">
        <div ng-attr-gallery-window="{{((width && width < 1280 || (item.nid && item.type != 'guide' && item.type !='areaguide')) && (parentIndex == 0 || (parentIndex == 1 && item.type != 'guide'))) === true ? true : undefined}}"
          ng-class="{'gallery-window' : ((width && width < 1280 || (item.nid && item.type != 'guide' && item.type !='areaguide')) && (parentIndex == 0 || (parentIndex == 1 && item.type != 'guide'))) === true }">
          <div ng-attr-gallery-item-list="{{((width && width < 1280 || (item.nid && item.type != 'guide' && item.type !='areaguide')) && (parentIndex == 0 || (parentIndex == 1 && item.type != 'guide'))) === true ? true : undefined}}"
            ng-class="{'gallery-item-list' : ((width && width < 1280 || (item.nid && item.type != 'guide' && item.type !='areaguide')) && (parentIndex == 0 || (parentIndex == 1 && item.type != 'guide'))) === true }" class="item-list">
            <div ng-repeat-start="fc_node in fc.nodes" ng-if="(parentIndex == 0 && ((width && width >= 1280 && ($index <= 4 && ($state.current.name == 'tabs.home' || item.type == 'areaguide' || item.type == 'guide' || item.hasOwnProperty('tid'))) || ($state.current.name != 'tabs.home' && item.type != 'areaguide' && item.type != 'guide' && !item.hasOwnProperty('tid'))) || (width && width < 1280))) || (parentIndex ==1 && (($index <= 4 && ($state.current.name == 'tabs.home' || item.type == 'areaguide')) || ($index <= 5)) && ((width >= 420 && $state.current.name == 'tabs.home') || ($state.current.name != 'tabs.home'))) || (parentIndex >= 2 && $index <= 5)" active="fc_node.active" class="listing"
              ng-attr-gallery-item="{{((width && width < 1280 || (item.nid && item.type != 'guide' && item.type !='areaguide')) && (parentIndex == 0 || (parentIndex == 1 && item.type != 'guide'))) === true ? true : undefined}}"
              ng-class="{'gallery-item' : ((width && width < 1280 || (item.nid && item.type != 'guide' && item.type !='areaguide')) && (parentIndex == 0 || (parentIndex == 1 && item.type != 'guide'))) === true }">
            <a href ui-sref="tabs.node({ path: fc_node.node_url, nid: fc_node.nid, tid: undefined, page: undefined})" analytics-on="click" analytics-category="relatedContent" analytics-event="contentClick" ng-attr-id="{{'link-section-' + parentIndex + '-' + $index}}" analytics-label="{{'link-section-' + fc_node.title.replace(title_replace_pattern, '_').toLowerCase()}}">
              <img
                class="tiles"
                ng-src="{{(fc_node.field_image.hasOwnProperty('und') && fc_node.field_image['und'][0]['uri']) ? (fc_node.field_image['und'][0]['uri'] |  s3url : ((parentIndex < 2 && item.type != 'guide') || (parentIndex == 0 && item.type == 'guide')) ? 'image300x250' : (parentIndex % 2 == 0 && item.type != 'guide') ? 'image100x100' : 'image220x190') : 'https://static.mommypoppins.com/undefined-image.jpg'}}"
                ng-class="{'even' : parentIndex % 2 == 0, 'odd' : parentIndex % 2 != 0, 'guide' : item.type == 'guide'}"
                >
              <div class="detail-title-bg" ng-class="{'featured' : fc_node.field_listing_level.und[0].value == 'PTNM' || fc_node.field_listing_level.und[0].value == 'Premium', 'sponsored' :  fc_node.field_pick.und[0].value == '1', 'guide' : fc_node.type == 'guide'}"></div>
              <div class="detail-title" ng-class="{'featured' : fc_node.field_listing_level.und[0].value == 'PTNM' || fc_node.field_listing_level.und[0].value == 'Premium'}">{{ fc_node.title }}</div>
              <div ng-if="(parentIndex < 2 && item.type != 'guide') || ((item.type == 'guide' || item.term_guide) && parentIndex == 0)" class="detail-desc" ng-class="{'featured' : fc_node.field_listing_level.und[0].value == 'PTNM' || fc_node.field_listing_level.und[0].value == 'Premium'}"><span ng-bind-html="fc_node.shortBody | sanitize"></span></div>
              <div ng-if="(parentIndex > 2  && parentIndex % 2 != 0) || (item.type == 'guide' && parentIndex > 0)" class="detail-desc"><span ng-bind-html="fc_node.shortBody | sanitize"></span> <span class="read-more">READ MORE <span class="chevron right"></span></span></div>
              <div class="tag sponsored" ng-if="parentIndex < 2 && fc_node.field_pick.und[0].value == '1'">SPONSORED</div>
              <div class="tag featured" ng-if="parentIndex < 2 && (fc_node.field_listing_level.und[0].value == 'PTNM' || fc_node.field_listing_level.und[0].value == 'Premium')">FEATURED</div>
              <div class="tag guide" ng-if="fc_node.type == 'guide'">GUIDE</div>
              <div
                ng-if="fc_node.hasOwnProperty('field_video_clip') && fc_node.field_video_clip.hasOwnProperty('und') && fc_node.field_video_clip.und.length > 0 && fc_node.field_video_clip.und[0].value != ''"
                class="video"
                ></div>
            </a>
          </div><!-- end listing-->
          <div ng-repeat-end ng-if="(parentIndex == 0 || (parentIndex == 1 && item.type != 'guide')) && $index==1" class="listing tiles ad ad-300x250" ng-class="'ad-'+$index" ng-attr-id="{{'wrapper-div-gpt-ad-' + $state.current.name + '-' + ((parentIndex == 0) ? '1' : '2')}}" 
              ng-attr-gallery-item="{{((width && width < 1280 || (item.nid && item.type != 'guide' && item.type !='areaguide')) && (parentIndex == 0 || (parentIndex == 1 && item.type != 'guide'))) === true ? true : undefined}}"
              ng-class="{'gallery-item' : ((width && width < 1280 || (item.nid && item.type != 'guide' && item.type !='areaguide')) && (parentIndex == 0 || (parentIndex == 1 && item.type != 'guide'))) === true }"
              serve-ad ad-unit="{{'mediumrectangle' + ((parentIndex == 0) ? '' : 'btf')}}" slot-slug="{{'div-gpt-ad-' + $state.current.name + '-' +((parentIndex == 0) ? '1' : '2') + ''}}">
          </div>
            </div><!-- end gallery-item -->
          </div><!-- end gallery-item-list -->
        </div><!-- end gallery-window -->
        <!--div gallery-indicators class="gallery-indicators"></div--><!-- The little dots that tell you where you are 
        -->
        <div ng-if="((width && width < 1280 || (item.nid && item.type != 'guide' && item.type !='areaguide')) && (parentIndex == 0 || (parentIndex == 1 && (item.type == 'areaguide' || (item.tid && $state.current.name != 'tabs.home') || ($state.current.name == 'tabs.home' && width >= 420)))))" class="gallery-nav" class="gallery-nav" ng-swipe-left="nextItem()" ng-swipe-right="previousItem()"><!-- Nav actions -->
          <a ng-click="previousItem()" class="previous" analytics-on="click" analytics-event="contentClick" analytics-category="galleryNav" analytics-label="gallery-previous" ng-attr-id="{{'gallery-previous-' + parentIndex}}"><span class="text">Previous</span></a>
          <a ng-click="nextItem()" class="next" analytics-on="click" analytics-event="contentClick" analytics-category="galleryNav" analytics-label="gallery-next" ng-attr-id="{{'gallery-next-' + parentIndex}}"><span class="text">Next</span></a>
        </div>
        </div><!-- end listings-wrapper-->
        <div ng-if="width >=1280 && $index == 0 && (($state.current.name == 'tabs.home' || item.type == 'areaguide') || ((item.tid || item.type == 'guide') && $state.current.name != 'tabs.home'))" ng-init="widget = (($state.current.name == 'tabs.home' || item.type == 'areaguide')) ? 'node' : (item.tid && $state.current.name != 'tabs.home') ? 'term' : (item.type == 'guide' && $state.current.name != 'tabs.home') ? 'guide' : null" ng-include="" src="domainStatic + '/sites/all/themes/mp_world/templates/sidebar.html'" class="sidebar-widget"></div>
      </div><!-- end gallery-big -->
    </div><!-- content-wrapper -->
  </div>
  <div ng-if="parentIndex == 0" class="sponsored-wrapper">
    <div class="content-wrapper">
      <div ng-attr-id="{{'wrapper-div-gpt-ad-' + $state.current.name + '-3'}}" serve-ad ad-unit="textad" slot-slug="{{'div-gpt-ad-' + $state.current.name + '-3'}}">
      </div>
    </div>
  </div>
    <div ng-if="width < 1280 && (($state.current.name == 'tabs.home' || item.type == 'areaguide') || ((item.tid || item.type == 'guide') && $state.current.name != 'tabs.home')) && $index == 0" ng-init="widget = (($state.current.name == 'tabs.home' || item.type == 'areaguide')) ? 'node' : (item.tid && $state.current.name != 'tabs.home') ? 'term' : (item.type == 'guide' && $state.current.name != 'tabs.home') ? 'guide' : null" ng-include="" src="domainStatic + '/sites/all/themes/mp_world/templates/sidebar.html'" ng-class="width < 660 ? 'middlebar-widget' : 'sidebar-widget'"></div>
  <div ng-if="parentIndex == 0 && latestList" class="controls-wrapper">
    <div class="content-wrapper">
      <div ng-if="item.vid" ng-include="" src="domainStatic + '/sites/all/themes/mp_world/templates/fields/controls.html'"></div>
    </div>
  </div>
<div ng-if="parentIndex == 0 && !item.hasOwnProperty('tid') && item.type == 'guide' && termTitle && termList && termList.length > 0" ng-hide="termTitle == 'Categories' || termTitle == 'More Activities'" class="middlebar-widget content-wrapper">
   <div class="term-list">
   <div class="title-bar" ng-class="{'term-key' : termKey}" ng-style="{textAlign: 'center'}">
     <a ng-if="termKey" href ui-sref="tabs.directoryType({ roottype: termKey.replace(' ', '-'), area: area.hasOwnProperty('tid') ? area.tid : '', type: termTid})" analytics-on="click" analytics-category="{{item.hasOwnProperty('type') ? item.type : 'term' }}" analytics-event="contentClick" analytics-label="link-termseeall" id="link-termseeall">
       <div class="header">See all our listings in our directory:</div>
     </a>
     <div>
     <a ng-if="termKey" href ui-sref="tabs.directoryType({ roottype: termKey.replace(' ', '-'), area: area.hasOwnProperty('tid') ? area.tid : '', type: termTid})" analytics-on="click" analytics-category="{{item.hasOwnProperty('type') ? item.type : 'term' }}" analytics-event="contentClick" analytics-label="{{'link-termtitle-' + termTitle.replace(title_replace_pattern, '_').toLowerCase()}}" ng-attr-id"{{'link-termtitle-' + $index}}">
       <img ng-src="{{['camps','classes','preschool','party', 'family fun'].indexOf(termKey.toLowerCase()) >= 0 ? domainStatic + '/sites/all/themes/mp_world/images/directory-title-' + termKey.replace(' ', '-') + '.jpg' : ''}}">
       <span class="title" ng-bind-html="termTitle | sanitize"></span>
     </a>
     </div>
     <div ng-if="!termKey" class="title" ng-bind-html="termTitle | sanitize"></div>
   </div>
      <ul>
        <li ng-repeat="term in termList | orderBy: 'name'">
          <!--a ng-if="term.vid == 8" ui-sref="tabs.node({path: '/directory/' + termKey + '?type=' + term.tid, type: term.name})">{{term.name}}</a 
          -->
          <a ng-if="term.vid == 8" href ui-sref="tabs.directoryType({ roottype: termKey.replace(' ', '-'), area: area.hasOwnProperty('tid') ? area.tid : '', type: term.tid })" analytics-on="click" analytics-category="{{item.hasOwnProperty('type') ? item.type : 'term' }}" analytics-event="contentClick" analytics-label="{{'link-categorylist-' + term.name.replace(title_replace_pattern, '_').toLowerCase()}}" ng-attr-id="{{'link-categorylist-' + $index}}">{{term.name}}</a>
          <a ng-if="term.vid != 8" href ui-sref="tabs.node({ path: term.node_url, tid: term.tid, nid: undefined, page: undefined })" analytics-on="click" analytics-category="{{item.hasOwnProperty('type') ? item.type : 'term' }}" analytics-event="contentClick" analytics-label="{{'link-categorylist-' + term.name.replace(title_replace_pattern, '_').toLowerCase()}}" ng-attr-id="{{'link-categorylist-' + $index}}">{{term.name}}</a>
        </li>
      </ul>
   </div>
</div>
<div ng-if="(($state.current.name != 'tabs.home' && ((item.hasOwnProperty('type') && item.type == 'areaguide') || (!item.hasOwnProperty('type')))) || ($state.current.name == 'tabs.home' && width && width < 660)) && parentIndex == 0 && regionTitle && regionList && regionList.length > 0" class="term-list-wrapper regions middlebar-widget content-wrapper">
   <div class="title-bar link" ng-style="{textAlign: 'left'}" ng-click="regionListCollapse = !regionListCollapse">
     <div class="title" ng-bind-html="regionTitle | sanitize"></div>
     <img ng-src="{{domainStatic + '/sites/all/themes/mp_world/images/mp-chevron-thin-small-' + (regionListCollapse ? 'down' : 'up') + '.svg'}}" aria-hidden="true" />
   </div>
   <div class="term-list" uib-collapse="regionListCollapse" ng-init="regionListCollapse = (width && width < 1024 ? true : false)">
      <ul>
        <li ng-repeat="term in regionList | orderBy: 'name'">
          <!--a ng-if="term.vid == 8" ui-sref="tabs.node({path: '/directory/' + termKey + '?type=' + term.tid, type: term.name})">{{term.name}}</a
              -->
          <a ng-if="term.vid == 8" href ui-sref="tabs.directoryType({ roottype: termKey.replace(' ', '-'), area: area.hasOwnProperty('tid') ? area.tid : '', type: term.tid })" analytics-on="click" analytics-category="{{item.hasOwnProperty('type') ? item.type : 'term' }}" analytics-event="contentClick" analytics-label="{{'link-neighborhoodlist-' + term.name.replace(title_replace_pattern, '_').toLowerCase()}}" ng-attr-id="{{'link-neighborhoodlist-' + $index}}">{{term.name}}</a>
          <a ng-if="term.vid != 8" href ui-sref="tabs.node({ path: term.node_url, nid: undefined, tid: term.tid, page: undefined })" analytics-on="click" analytics-category="{{item.hasOwnProperty('type') ? item.type : 'term' }}" analytics-event="contentClick" analytics-label="{{'link-neighborhoodlist-' + term.name.replace(title_replace_pattern, '_').toLowerCase()}}" ng-attr-id="{{'link-neighborhoodlist-' + $index}}">{{term.name}}</a>
      </ul>
   </div>
</div>

  <div ng-repeat-end ng-if="$state.current.name == 'tabs.home' && parentIndex == 0 && latestList" class="latest-wrapper">
    <div class="content-wrapper">
      <div ng-if="latestList" id="term-nodes" ng-include="" src="domainStatic + '/sites/all/themes/mp_world/templates/fields/latest.html'" class="section latest"></div>
    </div>
  </div>
