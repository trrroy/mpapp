<div class="sponsored-wrapper">
  <div class="content-wrapper">
    <div ng-attr-id="{{'wrapper-div-gpt-ad-' + $state.current.name + '-3'}}" serve-ad ad-unit="textad" slot-slug="{{'div-gpt-ad-' + $state.current.name + '-3'}}">
    </div>
  </div>
</div>
<div class="main-wrapper content-wrapper">
  <div class="main-content content-wrapper">
    <div class="sidebar-wrapper">
      <div id="sidebar-links" ng-include="" src="domainStatic + '/sites/all/themes/mp_world/templates/sidebar.html'" ng-init="widget = 'directory'" class="sidebar-widget"></div>
    </div><!-- end sidebar-wrapper -->
    <div class="main-wrapper">
      <h1><em>Directory</em> Listings</h1>
      <div class="filters-wrapper">
        <div class="filters-title">Filters:</div>
        <span id="search-group" class="filter text">
          <input type="text" class="form-control directory-search" ng-model="searchWords" ng-keypress="changeSearchWords($event, searchWords)" placeholder="Search word or zip code" />
          <button ng-show="searchWords" ng-click="searchWords = ''; changeSearchWords($event, searchWords)">X</button>
        </span>
        <span class="filter">
          <div>
            <button ng-click="f.locations.status.open = !f.locations.status.open" ng-class="{'active' : f.locations.status.open}" class="filter-main">Locations</button>
            <button ng-click="f.ages.status.open = !f.ages.status.open" ng-class="{'active' : f.ages.status.open}" class="filter-main">Ages</button>
            <button ng-click="f.types.status.open = !f.types.status.open" ng-class="{'active' : f.types.status.open}" class="filter-main">Types</button>
            <button ng-hide="area.tid == 1312" ng-click="findDeals()" class="filter-main deal active" analytics-on="click" analytics-category="searchFilters" analytics-event="filterClick-directory" analytics-label="deals-go" ng-attr-id="directory-deals-go">Deals</button>
          </div>
          <div class="tabs-horiz">
            <uib-accordion close-others="true">
              <uib-accordion-group is-open="f.locations.status.open" ng-init="f.locations.status.open = false" >
                <div id="neighborhood-group" class="filters" ng-include="" src="domainStatic + '/sites/all/themes/mp_world/templates/search-filter.html'" ng-controller="SearchFiltersController" ng-init="serviceType = 'directory'; itemType = 'directoryNeighborhoods'; label = 'locations'"></div>
              </uib-accordion-group>
              <uib-accordion-group heading="Ages" is-open="f.ages.status.open" ng-init="f.ages.status.open = false">
                <div id="ages-group" class="filters" ng-include="" src="domainStatic + '/sites/all/themes/mp_world/templates/search-filter.html'" ng-controller="SearchFiltersController" ng-init="serviceType = 'directory'; itemType = 'ages'; label = 'ages'"></div>
              </uib-accordion-group>
              <uib-accordion-group heading="Types" is-open="f.types.status.open" ng-init="f.types.status.open = false">
                <div id="types-group" class="filters" ng-include="" src="domainStatic + '/sites/all/themes/mp_world/templates/search-filter.html'" ng-controller="SearchFiltersController" ng-init="serviceType = 'directory'; itemType = 'directoryTypes'; label = 'types'"></div>
              </uib-accordion-group>
            </uib-accordion>
          </div>
        </span>
        <br class="clear" />
      </div><!-- end filters-wrapper-->
      <div id="tab-buttons">
        <a href
          ui-sref="tabs.search({'keys': (searchWords && searchWords != '' && searchWords != undefined ? searchWords : '')})"
          >Articles
        </a>
        <div
          class="active"
          >Directory
          </div>
        <a href
          ui-sref="tabs.events({'area[]': (area && area.tid ? area.tid : ''), 'keys': (searchWords && searchWords != '' && searchWords != undefined ? searchWords : '') })"
          >Events
        </a>
      </div>
      <div class="selections">
         <div ng-repeat="tag in showTags track by $index" class="tag" ng-class="tag.filterName">{{ tag.name }} <a href="" ng-click="removeFilter('directory', tag.filterName, tag)">X</a></div>
      </div>
      <div class="results-wrapper map-wrapper">
        <uib-accordion close-others="false">
          <uib-accordion-group heading="{{ totalListings > 0 ? 'Showing ' + totalPage + ' of ' + totalListings + ' listings. Use filters to refine results.' : totalListings == 0 ? 'No results. Change filters to try again.' : 'searching...' }}" ng-init="mapStatus.open=false" is-open="mapStatus.open">
          <div id="map_canvas">
            <ui-gmap-google-map center="map.center" zoom="map.zoom" draggable="true" dragging="true" options="options" pan="true">
              <ui-gmap-markers models="markers" coords="'self'" fit="true">
                <ui-gmap-marker idKey="marker.id" ng-repeat="marker in markers" coords="marker.coords" options="marker.options" icon="marker.icon" doCluster="map.doCluster" ng-click="marker.showInfo = true" ng-init="marker.showInfo = false">
                  <marker-label content="marker.name" anchor="2 0" class="marker-labels"/>
                    <ui-gmap-window ng-cloak  coords="marker.coords" isIconVisibleOnClick="true" options="options" show="marker.showInfo">
                      <div class="map-infowindow" ng-class="{'small': marker.content.image == ''}">
                        <img ng-if="marker.content.image != ''" ng-src="{{marker.content.image | s3url: 'image140x116'}}">
                        <strong>{{marker.content.title}}</strong>
                        <div ng-if="marker.content.description != ''">{{marker.content.description}}</div>
                        <div ng-if="marker.content.link != ''"><a href ng-click="$root.popNode({{marker.content.nid}})" class="read-more">read more<span class="chevron right"></span></a></div>
                      </div>
                    </ui-gmap-window>
                </ui-gmap-marker>
              </ui-gmap-markers>
            </ui-gmap-google-map>
          </div>
          </uib-accordion-group>
          <div ng-show="mapStatus.open && totalListings > 0" class="close-map"><a href ng-click="mapStatus.open = false">Close Map <strong>X</strong></a></div>
          <div ng-show="!mapStatus.open && totalListings > 0" class="open-map"><a href ng-click="mapOpen()" analytics-on="click" analytics-category="map" analytics-event="mapClick" analytics-label="listings-map-view-click" id="listings-map-view"><i class="fa fa-map-marker" aria-hidden="true"></i> Show map of locations</a></div>
        </uib-accordion>
        <div id="the-list" ng-include="" src="domainStatic + '/sites/all/themes/mp_world/templates/list.html'" ng-controller="TheListController" ng-init="listType = 'directoryListing'"></div>
      </div><!-- end results-wrapper  -->
    </div><!-- end main-wrapper -->
  </div><!-- end main-content content-wrapper -->
</div><!-- end main-wrapper -->
